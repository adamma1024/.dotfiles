{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Skill Rules Configuration",
  "description": "Configuration for automatic skill activation based on prompt analysis",
  "type": "object",
  "required": [
    "version",
    "config",
    "scoring",
    "skills"
  ],
  "properties": {
    "$schema": {
      "type": "string",
      "description": "JSON Schema reference"
    },
    "version": {
      "type": "string",
      "description": "Schema version",
      "pattern": "^\\d+\\.\\d+$"
    },
    "config": {
      "type": "object",
      "description": "Global configuration options",
      "required": [
        "minConfidenceScore",
        "showMatchReasons",
        "maxSkillsToShow"
      ],
      "properties": {
        "minConfidenceScore": {
          "type": "integer",
          "minimum": 1,
          "description": "Minimum score required to suggest a skill"
        },
        "showMatchReasons": {
          "type": "boolean",
          "description": "Whether to show why each skill was matched"
        },
        "maxSkillsToShow": {
          "type": "integer",
          "minimum": 1,
          "maximum": 10,
          "description": "Maximum number of skills to show in output"
        }
      }
    },
    "scoring": {
      "type": "object",
      "description": "Points assigned to each match type",
      "required": [
        "keyword",
        "keywordPattern",
        "pathPattern",
        "directoryMatch",
        "intentPattern",
        "contentPattern",
        "contextPattern"
      ],
      "properties": {
        "keyword": {
          "type": "integer",
          "minimum": 1,
          "description": "Points for simple keyword match"
        },
        "keywordPattern": {
          "type": "integer",
          "minimum": 1,
          "description": "Points for regex pattern match"
        },
        "pathPattern": {
          "type": "integer",
          "minimum": 1,
          "description": "Points for file path glob match"
        },
        "directoryMatch": {
          "type": "integer",
          "minimum": 1,
          "description": "Points for directory mapping match"
        },
        "intentPattern": {
          "type": "integer",
          "minimum": 1,
          "description": "Points for user intent detection"
        },
        "contentPattern": {
          "type": "integer",
          "minimum": 1,
          "description": "Points for code content pattern match"
        },
        "contextPattern": {
          "type": "integer",
          "minimum": 1,
          "description": "Points for conversation context match"
        }
      }
    },
    "directoryMappings": {
      "type": "object",
      "description": "Map directory paths to skill names",
      "additionalProperties": {
        "type": "string",
        "description": "Skill name to suggest for this directory"
      }
    },
    "skills": {
      "type": "object",
      "description": "Skill definitions and their triggers",
      "additionalProperties": {
        "type": "object",
        "required": [
          "description",
          "triggers"
        ],
        "properties": {
          "description": {
            "type": "string",
            "description": "Human-readable description of what triggers this skill"
          },
          "priority": {
            "type": "integer",
            "minimum": 1,
            "maximum": 10,
            "default": 5,
            "description": "Skill priority (higher = suggested first when scores are equal)"
          },
          "triggers": {
            "type": "object",
            "description": "Conditions that trigger this skill",
            "properties": {
              "keywords": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Simple keywords to match (case-insensitive)"
              },
              "keywordPatterns": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Regex patterns to match in prompt"
              },
              "pathPatterns": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Glob patterns for file paths mentioned in prompt"
              },
              "intentPatterns": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Regex patterns to detect user intent (e.g., 'create.*test')"
              },
              "contentPatterns": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Patterns to match in code snippets"
              },
              "contextPatterns": {
                "type": "array",
                "items": {
                  "type": "string"
                },
                "description": "Phrases indicating conversation context"
              }
            }
          },
          "excludePatterns": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Patterns that exclude this skill from matching"
          },
          "relatedSkills": {
            "type": "array",
            "items": {
              "type": "string"
            },
            "description": "Skills to suggest alongside this one"
          }
        }
      }
    }
  }
}
